# Choreo Deployment Strategy\n\n## Overview\nThis document outlines the deployment strategy for the cell-based e-commerce application on the Choreo platform.\n\n## Choreo Platform Mapping\n\n### Cell-to-Project Mapping\nEach cell maps to a separate Choreo project, following the cell-based architecture principle:\n\n| Cell | Choreo Project | Components |\n|------|----------------|-----------|\n| Frontend Cell | `ecommerce-frontend` | frontend, loadgenerator |\n| Product Cell | `ecommerce-product` | productcatalogservice, recommendationservice |\n| Cart Cell | `ecommerce-cart` | cartservice |\n| Order Cell | `ecommerce-order` | checkoutservice |\n| Payment Cell | `ecommerce-payment` | paymentservice |\n| Fulfillment Cell | `ecommerce-fulfillment` | shippingservice, emailservice |\n| Marketing Cell | `ecommerce-marketing` | adservice |\n| Platform Cell | `ecommerce-platform` | currencyservice |\n\n### Project Configuration\nEach project will be configured with:\n- **Region**: US (primary), EU (secondary)\n- **Environment**: Development, Testing, Production\n- **Git Repository**: This monorepo with cell-specific paths\n- **Build Pipeline**: Automated CI/CD per cell\n\n## Deployment Order\n\n### Phase 1: Foundation Services\n1. **Platform Cell** (currencyservice)\n   - No dependencies\n   - Provides utility services\n   - Deploy first to ensure availability\n\n2. **Product Cell** (productcatalogservice, recommendationservice)\n   - No dependencies\n   - Self-contained domain\n   - Critical for frontend functionality\n\n3. **Cart Cell** (cartservice)\n   - No dependencies\n   - Self-contained domain\n   - Requires Redis configuration\n\n### Phase 2: Business Logic Services\n4. **Payment Cell** (paymentservice)\n   - No dependencies\n   - Self-contained domain\n   - Mock payment processing\n\n5. **Fulfillment Cell** (shippingservice, emailservice)\n   - No dependencies\n   - Self-contained domain\n   - Email templates configuration\n\n6. **Marketing Cell** (adservice)\n   - No dependencies\n   - Self-contained domain\n   - Ad content configuration\n\n### Phase 3: Orchestration Services\n7. **Order Cell** (checkoutservice)\n   - Depends on: Cart, Payment, Fulfillment, Platform\n   - Orchestrates business workflow\n   - Deploy after dependencies are stable\n\n### Phase 4: User Interface\n8. **Frontend Cell** (frontend, loadgenerator)\n   - Depends on: All other cells\n   - User-facing interface\n   - Deploy last to ensure all APIs are available\n\n## Choreo Project Setup\n\n### 1. Create Projects\n```bash\n# Create each project using Choreo CLI or API\nfor project in frontend product cart order payment fulfillment marketing platform; do\n    choreo project create \"ecommerce-${project}\" \\\n        --description \"E-commerce ${project} cell\" \\\n        --region \"US\" \\\n        --repository \"https://github.com/wx-yz/ecommerce-cell-based-architecture.git\" \\\n        --branch \"main\"\ndone\n```\n\n### 2. Configure Components\nEach project will have components configured with:\n- **Source Path**: `cells/{cell-name}/{component-name}/`\n- **Build Pack**: Language-specific (Go, Node.js, Python, Java, .NET)\n- **Port**: Component-specific port configuration\n- **Environment Variables**: Cell-specific configuration\n\n### 3. Environment Configuration\nEach project will have three environments:\n- **Development**: For feature development and testing\n- **Testing**: For integration testing and QA\n- **Production**: For live traffic\n\n## Choreo Connections\n\n### Connection Types\n\n#### 1. Service-to-Service Connections\n- **Type**: Internal API connections\n- **Protocol**: HTTP/gRPC\n- **Authentication**: Service-to-service tokens\n- **Load Balancing**: Choreo managed\n\n#### 2. External Connections\n- **Type**: External API connections\n- **Usage**: Platform cell â†’ Currency APIs\n- **Authentication**: API keys/tokens\n- **Rate Limiting**: Choreo managed\n\n### Connection Configuration\n\n#### Frontend Cell Connections\n```yaml\nconnections:\n  - name: \"product-api\"\n    target: \"ecommerce-product\"\n    protocol: \"http\"\n    path: \"/api/v1/products\"\n  - name: \"cart-api\"\n    target: \"ecommerce-cart\"\n    protocol: \"http\"\n    path: \"/api/v1/cart\"\n  - name: \"order-api\"\n    target: \"ecommerce-order\"\n    protocol: \"http\"\n    path: \"/api/v1/checkout\"\n  - name: \"platform-api\"\n    target: \"ecommerce-platform\"\n    protocol: \"http\"\n    path: \"/api/v1/currency\"\n  - name: \"marketing-api\"\n    target: \"ecommerce-marketing\"\n    protocol: \"http\"\n    path: \"/api/v1/ads\"\n```\n\n#### Order Cell Connections\n```yaml\nconnections:\n  - name: \"cart-api\"\n    target: \"ecommerce-cart\"\n    protocol: \"grpc\"\n    port: 7070\n  - name: \"payment-api\"\n    target: \"ecommerce-payment\"\n    protocol: \"grpc\"\n    port: 50051\n  - name: \"fulfillment-shipping-api\"\n    target: \"ecommerce-fulfillment\"\n    protocol: \"grpc\"\n    port: 50051\n  - name: \"fulfillment-email-api\"\n    target: \"ecommerce-fulfillment\"\n    protocol: \"grpc\"\n    port: 8080\n  - name: \"platform-api\"\n    target: \"ecommerce-platform\"\n    protocol: \"grpc\"\n    port: 7000\n```\n\n## Environment Variables\n\n### Frontend Cell\n```yaml\nenv:\n  - name: \"PORT\"\n    value: \"8080\"\n  - name: \"PRODUCT_CATALOG_SERVICE_ADDR\"\n    value: \"${CHOREO_CONNECTION_product-api}\"\n  - name: \"CART_SERVICE_ADDR\"\n    value: \"${CHOREO_CONNECTION_cart-api}\"\n  - name: \"RECOMMENDATION_SERVICE_ADDR\"\n    value: \"${CHOREO_CONNECTION_product-api}\"\n  - name: \"CHECKOUT_SERVICE_ADDR\"\n    value: \"${CHOREO_CONNECTION_order-api}\"\n  - name: \"CURRENCY_SERVICE_ADDR\"\n    value: \"${CHOREO_CONNECTION_platform-api}\"\n  - name: \"AD_SERVICE_ADDR\"\n    value: \"${CHOREO_CONNECTION_marketing-api}\"\n```\n\n### Order Cell\n```yaml\nenv:\n  - name: \"PORT\"\n    value: \"5050\"\n  - name: \"CART_SERVICE_ADDR\"\n    value: \"${CHOREO_CONNECTION_cart-api}\"\n  - name: \"PAYMENT_SERVICE_ADDR\"\n    value: \"${CHOREO_CONNECTION_payment-api}\"\n  - name: \"SHIPPING_SERVICE_ADDR\"\n    value: \"${CHOREO_CONNECTION_fulfillment-shipping-api}\"\n  - name: \"EMAIL_SERVICE_ADDR\"\n    value: \"${CHOREO_CONNECTION_fulfillment-email-api}\"\n  - name: \"CURRENCY_SERVICE_ADDR\"\n    value: \"${CHOREO_CONNECTION_platform-api}\"\n```\n\n## Configurations and Secrets\n\n### Configuration Management\n- **Application Config**: Use Choreo config maps\n- **Environment-specific**: Different values per environment\n- **Secret Management**: Use Choreo secrets for sensitive data\n\n### Example Configurations\n\n#### Cart Cell Redis Configuration\n```yaml\nconfigurations:\n  - name: \"redis-config\"\n    type: \"config-map\"\n    mount_type: \"env variable\"\n    env_variables: |\n      {\n        \"REDIS_ADDR\": \"redis:6379\",\n        \"REDIS_DB\": \"0\"\n      }\n```\n\n#### Platform Cell Currency API Secret\n```yaml\nconfigurations:\n  - name: \"currency-api-secret\"\n    type: \"secret\"\n    mount_type: \"env variable\"\n    env_variables: |\n      {\n        \"CURRENCY_API_KEY\": \"${CURRENCY_API_KEY}\"\n      }\n```\n\n## Monitoring and Observability\n\n### Choreo Built-in Monitoring\n- **Metrics**: Request rates, response times, error rates\n- **Logs**: Application logs with cell context\n- **Tracing**: Distributed tracing across cells\n- **Health Checks**: Endpoint health monitoring\n\n### Custom Monitoring\n- **Business Metrics**: Order completion rates, cart abandonment\n- **Performance Metrics**: Page load times, API response times\n- **Error Tracking**: Application errors with cell context\n\n## Security Configuration\n\n### Authentication\n- **Service-to-Service**: Choreo managed service tokens\n- **External APIs**: API keys in secrets\n- **User Authentication**: Session-based (frontend cell)\n\n### Authorization\n- **API Gateway**: Choreo managed API gateway\n- **Rate Limiting**: Per-cell rate limiting\n- **Access Control**: Role-based access per cell\n\n## Scaling Configuration\n\n### Auto-scaling\n- **Horizontal**: Scale replicas based on CPU/memory\n- **Vertical**: Scale resources based on demand\n- **Per-cell**: Independent scaling per cell\n\n### Resource Limits\n```yaml\nresources:\n  limits:\n    cpu: \"1000m\"\n    memory: \"512Mi\"\n  requests:\n    cpu: \"100m\"\n    memory: \"128Mi\"\n```\n\n## Disaster Recovery\n\n### Backup Strategy\n- **Configuration Backup**: Export Choreo configurations\n- **Data Backup**: Per-cell data backup strategy\n- **Cross-region**: Deploy to multiple regions\n\n### Recovery Process\n1. **Identify Failed Cell**: Monitor alerts\n2. **Isolate Impact**: Cell boundaries limit blast radius\n3. **Restore Service**: Redeploy affected cell\n4. **Verify Integration**: Test inter-cell connections\n\n## CI/CD Pipeline\n\n### Build Pipeline\n```yaml\nstages:\n  - build:\n      - compile/build application\n      - run unit tests\n      - security scanning\n  - deploy:\n      - deploy to development\n      - integration tests\n      - deploy to testing\n      - acceptance tests\n      - deploy to production\n```\n\n### Deployment Strategy\n- **Blue-Green**: Zero-downtime deployments\n- **Canary**: Gradual rollout for production\n- **Rollback**: Quick rollback on issues\n\n## Troubleshooting\n\n### Common Issues\n1. **Connection Failures**: Check Choreo connections\n2. **Service Discovery**: Verify service endpoints\n3. **Configuration Issues**: Check environment variables\n4. **Resource Limits**: Monitor resource usage\n\n### Debug Process\n1. **Check Logs**: View application logs in Choreo\n2. **Monitor Metrics**: Check performance metrics\n3. **Trace Requests**: Use distributed tracing\n4. **Test Connections**: Verify inter-cell connectivity